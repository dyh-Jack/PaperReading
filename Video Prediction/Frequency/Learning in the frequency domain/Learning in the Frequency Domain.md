#### Learning in the Frequency Domain

在传统方法中，高分辨率RGB图像通常在CPU上预处理，并传输到GPU/AI加速器进行实时推断。由于RGB格式的未压缩图像通常较大，因此CPU和GPU/AI加速器之间的通信带宽要求通常较高。这种通信带宽可能是系统性能的瓶颈。为了降低计算成本和通信带宽要求，高分辨率RGB图像被降采样为更小的图像，这通常会导致信息丢失，从而降低推理精度。 

![image-20220224171135529](C:\Users\dyh20200207\AppData\Roaming\Typora\typora-user-images\image-20220224171135529.png)

在我们的方法中，高分辨率RGB图像仍然在CPU上进行预处理。然而，它们首先转换到YCbCr颜色空间，然后转换到频域。此外，我们设计了基于学习的频道选择方法，用于探索给定CNN模型的频谱偏差，即哪些频率分量对后续推理任务更具信息性。这些发现促使我们删减用于推理的琐碎频率分量，这显著减少了输入数据的大小，从而降低了域变换的计算复杂性和所需的通信带宽，同时保持了推理的准确性。

![image-20220224171445586](C:\Users\dyh20200207\AppData\Roaming\Typora\typora-user-images\image-20220224171445586.png)

我们遵循空间域中的预处理和增强流程，包括图像大小调整、裁剪和翻转（图2中的空间大小调整和裁剪）。然后将图像转换到YCbCr颜色空间，并转换到频域（图2中的DCT变换）。相同频率的二维DCT系数被分组到一个通道中，以形成三维DCT立方体（图2中的DCT重塑）。如第3.2节所述，选择了一部分有影响的频率通道（图2中的DCT通道选择）。YCbCr颜色空间中选定的通道连接在一起，形成一个张量（图2中的DCT连接）。最后，通过训练数据集计算的均值和方差对每个频率通道进行归一化。 

![image-20220224171919289](C:\Users\dyh20200207\AppData\Roaming\Typora\typora-user-images\image-20220224171919289.png)

我们对于每一个输入的图像变换到YCrCb上，设输入图像为$H\times W\times C$，其中C=3，那么变换到频域上之后图像变为$H/8\times W/8\times 64C$,维持计算量不变。由于频域的信息传递较快，我们可以将448x448x3的图像转换为56x56x192的频域图像，从而避免了对图像进行下采样带来的信息损失。

由于输入特征的不同通道处于不同的频率，我们推测某些频率通道对后续任务（如图像分类、对象检测和实例分割）的信息量较小，移除琐碎的频率通道不会导致性能下降。因此，我们提出了一种基于学习的信道选择机制，以利用每个输入频率信道的相对重要性。我们采用了一个动态门模块，为每个频率通道分配一个二进制分数。突出通道被评定为一，其他通道被评定为零。分数为零的输入频率通道与网络分离。因此，减少了输入数据的大小，从而降低了域变换的计算复杂度和通信带宽需求。该门模块结构简单，可以作为在线推理模型的一部分。

![image-20220224172638789](C:\Users\dyh20200207\AppData\Roaming\Typora\typora-user-images\image-20220224172638789.png)

之后我们通过一个门结构对通道进行选择。首先我们通过全局平均池化将T1变为T2，再进行1x1卷积变为T3，之后乘以两个可学习的参数变为T4，推理时将每一个通道的两个数字进行归一化，并作为采样与否的概率。例如有一个通道两数字分别为7.5和2.5，那么这个通道不被选择的概率为75%。

然而，我们所提出的门模块中的一个挑战是，在需要更新门模块中的权重时，采样过程是不可微的。[33,34,35]提出了一种重新参数化方法，称为Gumbel  Softmax技巧，该方法允许梯度通过离散采样过程反向传播。

我们在损失函数中添加了一个正则化项，以平衡所选频率通道的数量，该项与交叉熵损失或其他与精度相关的损失一起最小化。因此，我们的损失函数如下：

![image-20220224174941924](C:\Users\dyh20200207\AppData\Roaming\Typora\typora-user-images\image-20220224174941924.png)

其中$F(x_i)$代表所设计的门模块，$F(x_i)\in \{0,1\}$。

此外，我们对于频率通道的选择做了可视化处理，得到了一些观察结果：

- 选择低频通道（序号较小的盒子）的频率比选择高频通道（序号较大的盒子）的频率要高得多。这表明，在视觉推理任务中，低频通道通常比高频通道信息更丰富。
- luma分量Y中的频率通道比色度分量Cb和Cr中的通道选择得更频繁。这表明luma分量对视觉推理任务的信息量更大。
- 热图在分类和分割任务之间有一个共同的模式。这表明，上述两个观察结果并非特定于一项任务，很可能是更高层次视觉任务的一般性观察结果。 
- **上述结果与JPEG等图片压缩方式一致。**

![image-20220224175331471](C:\Users\dyh20200207\AppData\Roaming\Typora\typora-user-images\image-20220224175331471.png)

遵循观察结果，我们静态地选择较低的频率通道，重点放在亮度分量上，而不是色度分量上。这确保了具有更高激活概率的频率通道被输入CNN模型。其余的频率通道可以通过图像编码器或解码器进行修剪，以减少所需的数据传输带宽和输入数据大小。 